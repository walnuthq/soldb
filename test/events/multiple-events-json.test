# Test soldb list-events with --json-events flag (increment function emits 3 events)
# REQUIRES: soldb
# This test checks that the --json-events flag produces valid JSON output for multiple events
# The increment function calls increment2 and increment3, each emitting CounterIncremented event
# RUN: %soldb list-events %{test_tx} --ethdebug-dir %{contract_address}:TestContract:%{ethdebug_dir} --rpc %{rpc_url} --json-events 2>&1 | FileCheck %s

# When using --json-events flag, we should get valid JSON output with the events structure
# CHECK: {

# Check transaction hash field
# CHECK: "transaction_hash":

# Check for the main JSON structure fields
# CHECK: "events": [

# CHECK: {
# Check individual event structure (first event)
# CHECK: "index": 0,
# CHECK: "address": "[[CONTRACT_ADDRESS:.*]]",
# CHECK: "topics": [
# CHECK: "0x3cf8b50771c17d723f2cb711ca7dadde485b222e13c84ba0730a14093fad6d5c"
# CHECK: ],
# CHECK: "data": "0x{{[0-9a-fA-F]+}}",
# CHECK: "datas": [
# CHECK: {
# CHECK: "name": null,
# CHECK: "type": "hex",
# CHECK: "value": "0x{{[0-9a-fA-F]+}}"
# CHECK: }
# CHECK: ],
# CHECK: "event": "",
# CHECK: "signature": "0x3cf8b50771c17d723f2cb711ca7dadde485b222e13c84ba0730a14093fad6d5c"
# CHECK: },

# CHECK: {
# Check individual event structure (second event)
# CHECK: "index": 1,
# CHECK: "address": "[[CONTRACT_ADDRESS:.*]]",
# CHECK: "topics": [
# CHECK: "0x3cf8b50771c17d723f2cb711ca7dadde485b222e13c84ba0730a14093fad6d5c"
# CHECK: ],
# CHECK: "data": "0x{{[0-9a-fA-F]+}}",
# CHECK: "datas": [
# CHECK: {
# CHECK: "name": null,
# CHECK: "type": "hex",
# CHECK: "value": "0x{{[0-9a-fA-F]+}}"
# CHECK: }
# CHECK: ],
# CHECK: "event": "",
# CHECK: "signature": "0x3cf8b50771c17d723f2cb711ca7dadde485b222e13c84ba0730a14093fad6d5c"
# CHECK: },

# CHECK: {
# Check individual event structure (third event)
# CHECK: "index": 2,
# CHECK: "address": "[[CONTRACT_ADDRESS:.*]]",
# CHECK: "topics": [
# CHECK: "0x3cf8b50771c17d723f2cb711ca7dadde485b222e13c84ba0730a14093fad6d5c"
# CHECK: ],
# CHECK: "data": "0x{{[0-9a-fA-F]+}}",
# CHECK: "datas": [
# CHECK: {
# CHECK: "name": null,
# CHECK: "type": "hex",
# CHECK: "value": "0x{{[0-9a-fA-F]+}}"
# CHECK: }
# CHECK: ],
# CHECK: "event": "",
# CHECK: "signature": "0x3cf8b50771c17d723f2cb711ca7dadde485b222e13c84ba0730a14093fad6d5c"
# CHECK: }

# Verify JSON array and object closing
# CHECK: ],

# Check for total_events field with value 3
# CHECK: "total_events": 3

# Verify JSON object closing
# CHECK: }