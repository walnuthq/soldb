# REQUIRES: soldb, sepolia-rpc
# RUN: %soldb trace 0x1362ee26050935178c2f491dbe2a5f0d277903cb5d77fa9e6e30d8b2db31a541 --ethdebug-dir 0x6a85ebf0Eba5307943bDF27D02d198Bc64e9ffEd:TaxCalculator:%{project_root}/test/walnut_0x75964ba0087ff8ae69bd7c17c8c4db66bc0c8e75603f79de1265c61ddfd98f2e_1756985337815_2zvewt/0x6a85ebf0Eba5307943bDF27D02d198Bc64e9ffEd/debug --ethdebug-dir 0xbE734aD6434E16f6bE04706005faED6fD38eb2B2:ShippingManager:%{project_root}/test/walnut_0x75964ba0087ff8ae69bd7c17c8c4db66bc0c8e75603f79de1265c61ddfd98f2e_1756985337815_2zvewt/0xbE734aD6434E16f6bE04706005faED6fD38eb2B2/debug --ethdebug-dir 0xf776FF56e2400e31f3070c1ac70Ab80433B01823:PaymentProcessor:%{project_root}/test/walnut_0x75964ba0087ff8ae69bd7c17c8c4db66bc0c8e75603f79de1265c61ddfd98f2e_1756985337815_2zvewt/0xf776FF56e2400e31f3070c1ac70Ab80433B01823/debug --rpc %{sepolia_rpc_url} | FileCheck %s

# Check that we get the basic tracing output structure
# CHECK: Connecting to RPC: https://opt-sepolia.g.alchemy.com/v2/{{.*}}
# CHECK: Loading transaction 0x1362ee26050935178c2f491dbe2a5f0d277903cb5d77fa9e6e30d8b2db31a541...
# CHECK: Function Call Trace: 0x1362ee26050935178c2f491dbe2a5f0d277903cb5d77fa9e6e30d8b2db31a541
# CHECK:   TaxCalculator (0x6a85ebf0Eba5307943bDF27D02d198Bc64e9ffEd)
# CHECK:   ShippingManager (0xbE734aD6434E16f6bE04706005faED6fD38eb2B2)
# CHECK:   PaymentProcessor (0xf776FF56e2400e31f3070c1ac70Ab80433B01823)
# CHECK:   Gas used: 82711
# CHECK:   Status: SUCCESS
# CHECK:   Call Stack:
# CHECK:   ------------------------------------------------------------
# CHECK:   #0 Contract::runtime_dispatcher [entry] [non-verified] gas: 60499 @ Contract entry point
# CHECK:     #1 processOrder(uint256,string,string) [0x6f10e157] [value: 11300000000000000] [external] [non-verified] gas: 60499
# CHECK:        steps: 0-5256
# CHECK:        arguments: 0x00000000000000000000000000000000000000000000000000000000000003e8000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000008706879736963616c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000076578707265737300000000000000000000000000000000000000000000000000
# CHECK:       #2 CALL → 0xdcDd...Ac0A::log(string) [0x41304fac] [CALL] [non-verified] gas: 3680
# CHECK:          steps: 397-658
# CHECK:          arguments: 0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000195374617274696e67206f726465722070726f63657373696e6700000000000000
# CHECK:       #3 CALL → TaxCalculator::calculateTax(uint256,string) [0x55ec8a03] [CALL] → TaxCalculator gas: 7530
# CHECK:          steps: 965-1685
# CHECK:          value: 1000
# CHECK:          orderType: physical
# CHECK:         #4 calculateTax [internal] gas: 44510 @ TaxCalculator.sol:7
# CHECK:            steps: 1103-5256
# CHECK:           #5 getBaseRate [internal] gas: 3432 @ TaxCalculator.sol:18
# CHECK:              steps: 1170-1685
# CHECK:       #6 CALL → 0xdcDd...Ac0A::logValue(uint256) [0xfc8a475f] [CALL] [non-verified] gas: 2763
# CHECK:          steps: 1970-2175
# CHECK:          arguments: 0x0000000000000000000000000000000000000000000000000000000000000050
# CHECK:       #7 CALL → ShippingManager::initiateShipping(address,string) [0x01567ce2] [CALL] → ShippingManager gas: 8190
# CHECK:          steps: 2496-3124
# CHECK:          customer: 0x286AF310eA3303c80eBE9a66F6998B21Bd8c1c29
# CHECK:           #8 initiateShipping [internal] gas: 31317 @ ShippingManager.sol:8
# CHECK:              steps: 2648-5256
# CHECK:             #9 estimateShipping [internal] gas: 2208 @ ShippingManager.sol:17
# CHECK:                steps: 2796-3124
# CHECK:       #10 CALL → 0xdcDd...Ac0A::logValue(uint256) [0xfc8a475f] [CALL] [non-verified] gas: 2540
# CHECK:          steps: 3408-3613
# CHECK:          arguments: 0x0000000000000000000000000000000000000000000000000000000000000032
# CHECK:       #11 CALL → PaymentProcessor::processPayment(address,uint256) [0x0b63fe95] [value: 1080] [CALL] → PaymentProcessor gas: 9193
# CHECK:          steps: 4039-4307
# CHECK:          from: 0x286AF310eA3303c80eBE9a66F6998B21Bd8c1c29
# CHECK:          amount: 1080
# CHECK:             #12 processPayment [internal] gas: 1762 @ PaymentProcessor.sol:7
# CHECK:                steps: 4168-4307
# CHECK:       #13 CALL → 0xdcDd...Ac0A::logBoth(string,uint256) [0xe4af64b1] [CALL] [non-verified] gas: 4657
# CHECK:          steps: 4594-4981
# CHECK:          arguments: 0x00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000438000000000000000000000000000000000000000000000000000000000000000e4f7264657220636f6d706c657465000000000000000000000000000000000000
